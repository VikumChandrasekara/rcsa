@model List<rcsa.Models.AssessmentAnswer>
@{

    Layout = "~/Views/Shared/_aLayout.cshtml";
    string userRole = @ViewBag.BranchName;
}
<div class="container mt-4">

    <h2 class="text-success"> Assessment</h2>

    <div class="table-responsive mt-3">

        

            <div class="row mt-3">
                <!-- First Form -->
                <div class="col-md-6">
                    <form action="/Assessment/AdminReview" method="get">
                        <div class="form-group">
                            <label for="ServiceCenterId">Select Branch</label>
                            <select class="form-control" id="ServiceCenterId" name="ServiceCenterId">
                                <option value="">Select Branch</option>
                                @foreach (var serviceCenter in ViewBag.Subbranchs)
                                {
                                    <option value="@serviceCenter.ServiceCenterId">
                                        @serviceCenter.BranchName
                                    </option>
                                }
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="dateRangeDropdown">Select Date</label>
                            <select class="form-control" id="dateRangeDropdown" name="fromdate">
                                <option value="">Select a Date</option>
                                @foreach (var date in ViewBag.fromdate)
                                {
                                    <option value="@date">@date.ToString("yyyy-MM-dd")</option>
                                }
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Search</button>
                    </form>
                </div>

                <!-- Second Form -->
                <div class="col-md-6">
                    <form action="/Assessment/AdminReview" method="get">
                        <div class="form-group">
                            <label for="ServiceCenterId">Select Service Center</label>
                            <select class="form-control" id="ServiceCenterId" name="ServiceCenterId">
                                <option value="">Select Service Center</option>
                                @foreach (var serviceCenter in ViewBag.ServiceCenters)
                                {
                                    <option value="@serviceCenter.ServiceCenterId">
                                        @serviceCenter.BranchName
                                    </option>
                                }
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="dateRangeDropdown">Select Date</label>
                            <select class="form-control" id="dateRangeDropdown" name="fromdate">
                                <option value="">Select a Date</option>
                                @foreach (var date in ViewBag.fromdate)
                                {
                                    <option value="@date">@date.ToString("yyyy-MM-dd")</option>
                                }
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Search</button>
                    </form>
                </div>
            </div>
      


        <div class="row mt-4">
            <form >
                <h5>Service Center ID: @Model.FirstOrDefault()?.ServiceCenterId</h5>
                <h5>Service Center: @ViewBag.BranchNameForServiceCenter</h5>
                <h5>From Date: @Model.FirstOrDefault()?.fromdate.ToString("yyyy-MM-dd") To Date: @Model.FirstOrDefault()?.todate.ToString("yyyy-MM-dd")</h5>

                <div class="table-responsive mt-3">
                    <table id="exportTable" class="table table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Question</th>
                                <th>Marks</th>
                                <th>Service Responed</th>
                                <th>Branch Responed</th>
                                <th>Regon Responed </th>
                            </tr>
                        </thead>

                        <tbody>
                            @{
                                int index = 0;
                                int mainHeadingIndex = 1;
                            }

                            @foreach (var mainHeadingGroup in Model.GroupBy(q => q.headingTitel))
                            {
                                <!-- Main Heading -->
                                <tr class="table-success">
                                    <td colspan="6"><strong>@mainHeadingIndex. @mainHeadingGroup.Key</strong></td>
                                </tr>

                                int subHeadingIndex = 1;
                                @foreach (var subHeadingGroup in mainHeadingGroup.GroupBy(q => q.subheadingTitel))
                                {
                                    <!-- Sub Heading -->
                                    <tr class="table-info">
                                        <td colspan="6"><strong>@mainHeadingIndex.@subHeadingIndex. @subHeadingGroup.Key</strong></td>
                                    </tr>

                                    int questionIndex = 1;
                                    @foreach (var question in subHeadingGroup)
                                    {
                                        <tr data-service-center-id="@question.ServiceCenterId">
                                            <td>@mainHeadingIndex.@subHeadingIndex.@questionIndex</td>
                                            <td>
                                                @question.AnswerText
                                                <input type="hidden" name="[@index].QuestionId" value="@question.QuestionId" />
                                                <input type="hidden" name="[@index].QuestionText" value="@question.AnswerText" />
                                                <input type="hidden" name="[@index].Marks" value="@question.Marks" />
                                                <input type="hidden" name="[@index].MainHeading" value="@question.MainHeading" />
                                                <input type="hidden" name="[@index].SubHeading" value="@question.SubHeading" />
                                                <input type="hidden" name="[@index].ServiceCenterId" value="@question.ServiceCenterId" />
                                            </td>
                                            <td>@question.Marks</td>
                                            <td>
                                                <div class="col-md-2">
                                                    @{
                                                        string displayAnswers = question.ServiceCenterAnswer == "Yes" ? "Yes" :
                                                        question.ServiceCenterAnswer == "NO" ? "No" :
                                                        question.ServiceCenterAnswer == "NA" ? "N/A" : "";


                                                        bool hideServiceCenterAnswer = question.ServiceCenterflag == 0;
                                                    }

                                                    <span class="answer-label @(question.ServiceCenterAnswer == "NO" || question.ServiceCenterAnswer == "NA" ? "clickable" : "")"
                                                          data-comment="@question.Scomment"
                                                          onclick="showComment(this)"
                                                    @(hideServiceCenterAnswer ? "style=display:none;" : "")>
                                                        @displayAnswers
                                                    </span>

                                                    <input type="hidden" name="[@index].ServiceCenterAnswer" value="@question.ServiceCenterAnswer"
                                                    @(hideServiceCenterAnswer ? "style=display:none;" : "") />
                                                    <input type="hidden" name="[@index].Scomment" value="@question.Scomment" />
                                                </div>
                                            </td>
                                            <td>
                                                <div class="col-md-2">
                                                    @{
                                                        string displayAnswerb = question.BranchAnswer == "Yes" ? "Yes" :
                                                        question.BranchAnswer == "NO" ? "No" :
                                                        question.BranchAnswer == "NA" ? "N/A" : "";
                                                    }

                                                    <span class="answer-label @(question.BranchAnswer == "NO" || question.BranchAnswer == "NA" ? "clickable" : "")"
                                                          data-comment="@question.Bcomment"
                                                          onclick="showComment(this)">
                                                        @displayAnswerb
                                                    </span>
                                                    <input type="hidden" name="[@index].BranchAnswer" value="@question.BranchAnswer" />
                                                    <input type="hidden" name="[@index].ServiceCenterAnswer" value="@question.ServiceCenterAnswer" />
                                                    <input type="hidden" name="[@index].Bcomment" value="@question.Bcomment" />
                                                </div>
                                            </td>
                                            <td>
                                                <div class="col-md-2">
                                                    @{
                                                        string displayAnswerr = question.RegionAnswer == "Yes" ? "Yes" :
                                                        question.RegionAnswer == "NO" ? "No" :
                                                        question.RegionAnswer == "NA" ? "N/A" : "";
                                                    }

                                                    <span class="answer-label @(question.RegionAnswer == "NO" || question.RegionAnswer == "NA" ? "clickable" : "")"
                                                          data-comment="@question.Rcomment"
                                                          onclick="showComment(this)">
                                                        @displayAnswerr
                                                    </span>
                                                    <input type="hidden" name="[@index].BranchAnswer" value="@question.BranchAnswer" />
                                                    <input type="hidden" name="[@index].RegionAnswer" value="@question.RegionAnswer" />
                                                    <input type="hidden" name="[@index].ServiceCenterAnswer" value="@question.ServiceCenterAnswer" />
                                                    <input type="hidden" name="[@index].Rcomment" value="@question.Scomment" />
                                                </div>
                                            </td>
                                           
                                        </tr>

                                        index++;
                                        questionIndex++;
                                    }

                                    subHeadingIndex++;
                                }

                                mainHeadingIndex++;
                            }
                        </tbody>
                    </table>
                </div>
            </form>
        </div>

    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("[data-service-center-id]").forEach(row => {
            let serviceCenterId = row.getAttribute("data-service-center-id");
            let serviceCenterFlag = row.getAttribute("data-service-center-flag"); // Assuming you set this attribute in Razor

            if (serviceCenterFlag === "0") {
                row.querySelector(".answer-label").style.display = "none";
                row.querySelector("input[name*='ServiceCenterAnswer']").style.display = "none";
            }
        });
    });

    function showComment(element) {
        let comment = element.getAttribute("data-comment");
        if (comment) {
            alert("Comment: " + comment);
        }
    }
 @*    $(document).ready(function () {
        $("#searchForm").submit(function (event) {
            event.preventDefault(); // Prevent form from reloading the page

            var serviceCenterId = $("#ServiceCenterId").val(); // Get input value

            $.ajax({
                url: "/Assessment/AdminRegionReview",
                type: "GET",
                data: { ServiceCenterId: serviceCenterId },
                success: function (response) {
                    $("#resultTable").html(response); // Load response into the div
                },
                error: function () {
                    $("#resultTable").html("<p style='color: red;'>Error loading data.</p>");
                }
            });
        });
    }); *@

   
    function showComment(element) {
        let answer = element.innerText.trim(); // Get the displayed answer (Yes, No, NA)
        let comment = element.getAttribute("data-comment");

        if ((answer === "No" || answer === "N/A") && comment) {
            alert("Comment: " + comment);
        }
    }

</script>


<style>
    form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    select.form-control, select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 16px;
        background: #fff;
        color: #495057;
        margin-bottom: 15px;
    }

    button {
        background: #b10000;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

        button:hover {
            background: #8a0000;
        }

    select:focus {
        border-color: #80bdff;
        outline: none;
        box-shadow: 0px 0px 5px rgba(0, 123, 255, 0.5);
    }

</style>